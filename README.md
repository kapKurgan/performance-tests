# Нагрузочное тестирование на Python

В этом проекте реализовано нагрузочное тестирование для [Performance QA Engineer Course](https://github.com/Nikita-Filonov/performance-qa-engineer-course) — полнофункциональная образовательная банковская система, предназначенная для тестирования и проверки производительности в учебных средах. 

Платформа включает в себя такие сервисы, как "Kafka", "Redis", "PostgreSQL", "MinIO", "Grafana", "Prometheus", и предоставляет свой API как по протоколам HTTP, так и по протоколам gRPC.

**Используемые технологии**:

- `Python`
- `Locust`
- `Pydantic`
- `gRPC` / `grpcio`
- `HTTP` / `HTTPX`
- `Docker`
- `Kafka`
- `Redis`
- `PostgreSQL`
- `MinIO`
- `Grafana`
- `Prometheus`

Тесты производительности написаны на **Python** с использованием **Locust** и соответствуют современным принципам разработки программного обеспечения, таким как **SOLID**, **DRY** и **KISS**. 

Они предназначены для моделирования реалистичных бизнес-процессов и обеспечения наглядности производительности системы под нагрузкой.

---

## Оглавление

- [Обзор проекта](#project-overview)
- [Лучшие практики](#best-practices)
- [Начало работы](#getting-started)
- [Запуск тестов производительности](#running-performance-tests)
- [Мониторинг](#monitoring--observability)
- [CI/CD](#cicd)

---

## Обзор проекта

Этот фреймворк для тестирования производительности поддерживает как HTTP, так и gRPC API, используя унифицированную структуру тестирования.

Ключевые компоненты:

- **Scenarios**: Представляют реалистичные пользовательские потоки, реализованные с помощью пользовательских классов Locust.
- **API Clients**: Пользовательские повторно используемые HTTP/gRPC-клиенты, расположенные в [clients/http/](./clients/http) и [clients/grpc/](./clients/grpc), независимо от внутренних компонентов Locust.
- **Seeding**: Автоматическое создание тестовых данных с помощью [seeding builder] (./seeds/builder.py), запускаемого с помощью отслеживания событий Locust, основано на [scenario plan](./seeds/schema/plan.py).
- **Tools**: Включает генераторы тестовых данных, базовые конфигурации и общую логику пользователя Locust.
- **Reporting**: Встроенные HTML-отчеты для прогонов Locust; Метрики Prometheus и Grafana доступны на тестовом стенде курса.

Поддерживаемые бизнес-сценарии включают в себя:

- **Существующий пользователь**: совершение покупки, получение документов, выпуск виртуальной карты, просмотр операций.
- **Новый пользователь**: создание учетной записи, выпуск физической карты, пополнение карты, получение списка учетных записей и документов

---

## Лучшие практики

В этом проекте используются лучшие отраслевые стандарты:

- Принципы проектирования **SOLID** для поддержки клиентской архитектуры
- Подход **DRY**, позволяющий избежать дублирования в разных протоколах
- Философия **KISS**, позволяющая сохранять сценарии удобочитаемыми и сфокусированными
- Гибкая структура для поддержки тестирования как **HTTP**, так и **gRPC**
- API-клиенты, разработанные таким образом, чтобы их можно было компоновать и использовать
- Фреймворк легко расширять за счет новых сценариев или клиентских реализаций по мере развития системы

---

## Начало работы

### 1. Клонировать репозиторий

```bash
git clone https://github.com/kapKurgan/performance-tests.git
cd performance-tests
```

### 2. Создать виртуальную среду

#### Linux / MacOS

```bash
python3 -m venv venv
source venv/bin/activate
```

#### Windows

```bash
python -m venv venv
venv\Scripts\activate
```

### 3. Устанавить зависимости

```bash
pip install -r requirements.txt
```

---


## Запуск тестов производительности

Каждый сценарий может быть запущен с помощью отдельного файла конфигурации. 

Отчет будет автоматически сохранен в том же каталоге.

Пример:

```bash
locust --config=./scenarios/http/gateway/existing_user_get_documents/v1.0.conf
```

После выполнения теста откройте сгенерированный HTML-отчет: `./scenarios/http/gateway/existing_user_get_documents/report.html`

---

## Мониторинг

В дополнение к встроенным отчетам Locust, показатели системного уровня можно изучить с помощью:

- **Grafana:** http://localhost:3002
- **Prometheus:** http://localhost:9090

Эти информационные панели предварительно настроены в [course infrastructure repository](https://github.com/Nikita-Filonov/performance-qa-engineer-course).

---

## CI/CD

В этом проекте включена интеграция с GitHub Actions. Вы можете выполнять сценарии в автономном режиме и автоматически публиковать отчеты на страницах GitHub.

Конфигурацию можно найти в [.github/workflows/performance-tests.yml](./.github/workflows/performance-tests.yml).

